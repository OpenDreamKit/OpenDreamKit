\begin{workpackage}[id=UI,wphases=24-48,
  title=User Interfaces,
  PSRM=1,
  JURM=12, % active documents
  USHRM=12, % Supporting reproducible data science and sharing of models
  LLRM=1, % Jupyter
  SARM=1, % GAP
  UKRM=1, % Singular
  UBRM=1, % Pari
  USORM=21] % Southampton, \OOMMFNB

\begin{wpobjectives}
  The objective of this work package is to provide modern, robust,
  and flexible user interfaces for computation, supporting real-time
  sharing, integration with collaborative problem-solving,
  multilingual documents, paper writing and publication, links to
  databases, etc.
\end{wpobjectives}

\begin{wpdescription}
  Project Jupyter is a set of open-source software projects for interactive and exploratory
  computing. These software projects help make scientific computing and data science reproducible
  and multi-language (Python, Julia, R, Haskell, etc.). The main application offered by Jupyter is
  the Jupyter notebook, a web-based interactive computing platform that allows users to create
  data- and code-driven narratives that combine live code, equations, narrative text, interactive
  dashboards and other rich media. These documents provide a complete record of a computation that
  can be shared with others.


  \TOWRITE{Jupyter/...}{Add references of Jupyter's use in Europe}
  The Jupyter notebook is being used in all areas of academic (University of California, Berkeley,
  Stanford, University of Washington, New York University, Cal Poly, MIT, Harvard, Columbia, etc.)
  and government (NASA JPL, LBL, KBase, White House Hackathon) research as well as industry
  (Google, IBM, Facebook, Oracle, Otto Group, Microsoft, Bloomberg, JP Morgan, WhatsApp, Oâ€™Reilly,
  Quantopian, Logilab, GraphLab, Enthought, Continuum, Authorea, BuzzFeed, etc.) and journalism (538, New
  York Times, etc.). Because the architecture and building blocks of Jupyter are open, they are
  being used to build numerous other commercial and non-profit products and services. The Jupyter
  Notebook has between 500,000 and 1.5 million individual users worldwide.

  \TOWRITE{Jupyter}{One paragraph overview description of the Jupyter
    related tasks in the User Interface work package}

  \TOWRITE{Marcin/Hans/...}{Generalize the next paragraph to cover all
    User Interface demonstrators}

  The last tasks in this work package is focused on an
  \emph{application of the Jupyter notebook technology to a simulation
    package} that is actively used in materials research by a wide
  range of scientists and engineers, in academia and industry. We will
  develop a state-of-the art Jupyter notebook interface and frontend
  and demonstrate the power that this approach delivers to accelerate
  computational science, deliver better value for money and make
  computational science more robust.  We have chosen the Object
  Oriented MicroMagnetic Framework (OOMMF) simulation package
  \cite{OOMMF-url} as the target tool which is used to simulate
  magnetic nanostructures in over 1800 publications
  \cite{OOMMF-citations-url}. We use \OOMMFNB{} (for OOMMF NoteBook) as
  an identifier for this case study.
\end{wpdescription}

\begin{tasklist}
\begin{task}[title=Uniform notebook interface for all interactive components,id=ipython-kernels]
  In this task, we will implement Jupyter interfaces for the
  interactive computation components of \TheProject, including GAP,
  Pari, Sage, and Singular. A first release
  \delivref{UI}{ipython-kernels-basic} will focus on basic functionality,
  and a second release \delivref{UI}{ipython-kernels} will cover advanced
  features like 3D graphics or transparent documentation browsing (as
  live worksheets whenever relevant).

  % Note from William: my student Andrew Ohana just mostly did
  % something like that for IPython, but then stopped.  Anyway, it's
  % very do-able based on a summer project from another student and a
  % bunch of work I did with THREE.js for SMC.

  Sage itself will require a specific treatment as it already has a
  notebook interface. Its development started about at the same time
  as the Jupyter notebook, with similar target features but a
  different agenda: the Sage notebook had to be available very quickly
  to solve pressing needs of the Sage community; instead the Jupyter
  notebook was to take its time and build robust foundations from the
  ground up. The two projects have exchanged a lot, and the Jupyter
  notebook, which benefits from a much larger user base and thus
  developer pool, has mostly caught up with the Sage notebook in terms
  of functionality. It's thus time for the Sage community to outsource
  this key but non disciplinary component and phase out the Sage
  notebook in favor of the Jupyter notebook.

  % In charge: Jupyter dev + dev in Orsay + community?
  The Sage and Jupyter convergence \delivref{UI}{ipython-kernel-sage} will
  require:
  \begin{itemize}
  \item Robust migration path and tools for Sage worksheets,
  \item Support for math, 2D, and interactive 3D output.,
    % \item Bundling of the Jupyter notebook and its dependencies within
    %   the Sage distribution. DONE
  \item Import and export of ReST documents, with full support for
    Sage's specific roles (math, ...),
  \item Support for remote Sage kernel, typically on the cloud, or
    running with a different Python version (Sage as a library),
  \item A migration path for interactive widgets implemented with
    Sage's \texttt{@interact} functionality.
  \end{itemize}

  Joint meetings and visits between the developers of Jupyter and of
  the computing components will be a key asset for this task.

\end{task}

\begin{task}[id=notebook-collab,title=Notebook improvements for collaboration]
  In this task, we will further improve tools for collaboration between
  authors of shared Jupyter notebooks.
  
  Version control tools, such as Git and Mercurial, have become an integral part of open and
  collaborative science and software. Version control tools allow reviewing proposed changes via
  diffing tools, and resolving conflicting changes with merge tools. Jupyter notebook documents,
  being text files, are relatively well suited to tracking in version control. However, being
  structured JSON data, diffing and merging are difficult. Tools shall be developed to provide
  better support for visual diffing and merging of Notebook documents, and integrated into existing
  version control workflows \delivref{UI}{jupyter-collab}.
  
  Given the interactive nature of Jupyter notebooks, live collaboration, where multiple authors
  work on the document simultaneously, as in Google Docs, is particularly desirable. The addition
  of potentially shared execution adds both value and challenge to live collaboration. Various
  projects have added some amount of live sessions from outside (SageMathCloud, Colaboratory), but
  outside the core project. There are many different aspects of collaboration to explore,
  including shared or separate execution for authors collaborating on a single notebook,
  UI to indicate not only authorship,
  but which author triggered which execution, and other challenges.
  Various avenues for live session collaboration will be explored for integration into Jupyter itself
  \delivref{UI}{jupyter-live-collab}.
\end{task}




\begin{task}[id=notebook-verification,title=Reproducible Notebooks]
  In this task, we will develop tools that allow to re-execute
  notebook documents with automated regression testing. The computed
  output will be compared against the stored output, and deviations
  reported as assertion errors.

  Notebooks are used in a variety of contexts, like training and
  teaching material (tutorials, documentation, books) or computer
  experimentation logbooks, where reproducibility is critical: the
  notebooks shall remain functional and correct in the long run, even
  when the underlying computational software or infrastructure changes
  over time or across platforms.

  This task is a critical step toward reproducibility, allowing the
  notebook author to get an immediate notice when, e.g., a backward
  incompatible change occurs. It becomes even possible to anticipate
  such situations upstream by including important notebooks directly
  in the automated test suite of the computational software, giving an
  easy way for casual users to contribute regression tests.

  Technically speaking, Jupyter notebooks store outputs as rich mime-type structures,
  with JSON metadata. Using this metadata, it will be possible to express
  expectations of output, allowing more flexible and powerful tests
  than direct text comparison \delivref{UI}{jupyter-test}.
  Prior work has been done in Sage for ReST files, e.g. \lstinline{sage -t notebook.rst},
  and this model will be extended to notebooks.
\end{task}

\begin{task}[id=dynamic-inspect,title=Dynamic documentation and exploration system]

  Introspection has become a critical tool in interactive computation,
  allowing user to explore on the fly the properties and capabilities
  of the objects under manipulation. This becomes particularly acute
  in systems like Sage where large parts of the class hierarchy is
  built dynamically, and static documentation builders like Sphinx
  cannot anymore render all the available information.

  In this task, we will investigate how to further enhance the user
  experience. This will include:

  \begin{itemize}
  \item On the fly generation of Javadoc style documentation, through
    introspection, allowing e.g. the exploration of the class
    hierarchy, available methods, etc.
  \item \TOWRITE{Logilab}{Inclusion of database queries and views}
  \item \delivref{UI}{ipython-advanced-interacts} (Month 36) Exploratory
    support for semantic-aware interactive widgets providing views on
    objects represented and or in databases

    Preliminary steps are demonstrated in the \texttt{Larch
      Environment} project (see demo video on
    \url{http://www.larchenvironment.com/}) and sage-explorer.

    Ultimate goal: automatically generated LMFDB-style interfaces.
    Mention Knowls, as dynamic context-free items of knowledge
  \end{itemize}


  Whenever possible, those features will be implemented generically
  for any computation kernel by extending the Jupyter protocol with
  introspection and documentation queries.

  % In charge: Jupyter dev + dev in Orsay + NT?
\end{task}

\begin{task}[title=Structured documents,id=structdocs]
  % \item \delivref{ipython-structured-documents} (Month ???)
  Support for writing interactive structured documents, and in
  particular papers, books, experimentation log books and reports,
  presentations, course notes, etc, with the following features:
  \begin{itemize}
  \item Static printed/PDF/HTML version and interactive version.\\
    Achieved by either importing or exporting document files in some
    standard format (LaTeX, ReST, Markdown, ...).
  \item Tests (\localtaskref{notebook-verification}).
  \item Collaborative editing.
  \item Version control.
  \end{itemize}
\end{task}

\TODO{include here everything about this topic in Needs.rst}

\TODO{Wherever relevant, create tickets with details, and refer to
  them here.}

\begin{task}[id=oommf-python-interface,title=OOMMF case study: Create Python interface to OOMMF code]
  % 6 person months

  First, we will identify best option for interfacing from Python to OOMMF
  core (C++) routines. The technical options include CTypes, Cython, Swig,
  and Boost-Python, all with particular
  advantages/disadvantages. Following analysis of the current OOMMF
  code layout and compilation model, we will use the most suitable
  tool, bearing in mind our ambition not to modify the OOMMF code so
  that the python interface we create remains functional and
  maintainable with minimal effort while the OOMMF core code is
  developed further by the OOMMF authors.

  The interface will expose the raw C++ objects in Python, and for
  clarity we will refer to this interface as \texttt{OOMMF-py-raw}, to
  annotate that this gives access to OOMMF from Python but in a RAW
  way. Creation of this \texttt{OOMMF-py-raw} is technically doable as
  OOMMF had been written allowing to do this from Tcl. The
  \texttt{OOMMF-py-raw} library for Python provides access to the
  OOMMF functionality but requires some care when being used.

  Secondly, we will create a user friendly Python library that
  combines the OOMMF-RAW capabilities we expect to become the main
  user interface to OOMMF in the medium term future. This will make
  use of object orientation to assist users in efficient and safe
  exploitation of the available facilities, following the design of
  the well-received high level Nmag simulation package
  \cite{Fischbacher2007a} interface \cite{Nmag-url}.

  Once this is completed, several new features will be available to
  OOMMF users: (i) ability to drive OOMMF from Python, (ii)
  computational steering, and (iii) combination of OOMMF simulation
  with the existing Python eco-system of computational tools.

  %Can remove the next paragraph if we are pushed for space.

  We illustrate the advantage of (iii) through an example: to solve
  the micromagnetic standard problem 3
  \cite{Micromagnetic-Standardproblem-3}, traditionally multiple OOMMF
  simulation runs would have to be conducted, and for each of those a
  new configuration file as to be written. Between these the size of
  the simulated geometry needs to be modified until two particular
  values of energy are the same. Given the new interface developed in
  this work package, this whole process can be replaced by one Python
  script that creates multiple OOMMF simulations, combined with a root
  finding method for the automatic iterative determination of the
  required simulation geometry.

  Parallel in developing this, a set of unit tests is created that can
  be run periodically as regression tests. For all tasks relating to
  \OOMMFNB, documentation and tests are created simultaneously with
  the code. All codes, tests and documentation will be made available as open source.

  We anticipate to start this task \localtaskref{oommf-python-interface}
  in month 4.
\end{task}

\begin{task}[title=OOMMF case study: Extend \texttt{OOMMF-py} with Jupyter
    notebook attributes and GUI templates,id=oommf-py-ipython-attributes]
  % 6 person months

  The web server based Notebook environment (Jupyter) allows to host,
  execute and document the Python-based OOMMF simulation in an
  executable document. In this interactive environment, the
  representation of objects can be overloaded, and can include
  representation of objects as text, as bitmaps or svg files. We will
  create this functionality so that magnetisation vector field objects
  can be presented as a rendered 3d and 2d-view of the magnetisation
  field, and similar features for scalar fields such as field
  components and energies. This allows the interactive exploration and
  computational steering of the behaviour of magnetic
  nanostructures. Depending on the development of 3d packages such as
  vispy, it may be possible to provide interactive data objects in the
  notebook.

  Beyond that, the Jupyter Widgets allow the creation of graphical
  user interface (GUI) like elements, and we will generate code to
  display these widgets on demand to (i) set up micromagnetic
  simulation using a GUI, and (ii) assist in post-processing
  simulation results. Not all OOMMF users are keen on using GUIs for
  simulation set up or post processing, but in particular new or
  infrequent users benefit significantly from this. Recent pilot work
  has shown that it is possible to make Jupyter Widgets interact with
  the python interpreter session and this allows to activate a
  GUI-like (widget based) interface when desired but to quickly return
  to the interpreter prompt, taking forward the results (data) from
  the GUI session \cite{IPython-widget-GUI-demo-youtube-2014} and
  providing a continuous path from scripting to GUI. We
  believe that having the ability to mix and match GUI-based and
  command driven analysis combines the best of both approaches and
  provides significant additional value.
\end{task}

\begin{task}[title=OOMMF case study: \OOMMFNB{} tutorial and
  documentation, id=oommf-tutorial-and-documentation]
  % 6 person months

  We will create documentation and a new tutorial on usage of OOMMF
  that introduces micromagnetic modelling in the new framework of
  \OOMMFNB{}, combined with complete documentation of the
  \texttt{OOMMF-Py} library. The documentation will be provided in
  form of executable Jupyter notebooks.

  The tutorial, in terms of content, will take guidance from the
  tutorial provided for Nmag \cite{Nmag-tutorial-url} but tailored for the
  special simulation capabilities of OOMMF, and will introduce the
  special capabilities of the new IPython interface for OOMMF.

  The output of this activity will deliver multiple benefits:
  providing a systematic introduction to \texttt{OOMMF-py} suitable for both
  those users (i) new to micromagnetic modelling and those (ii) new to
  the \texttt{OOMMF-py} interface. Because the documentation is developed in an
  Jupyter notebook, the documents are executable. For new learners
  this is a great simplification because they can skip through the
  given document and execute the given examples there and then: at the
  moment, this is a process of manually writing a script, or locating
  it in the directory structure of files, then executing this,
  subsequently opening and processing the data files, etc. In the new
  model, this end-to-end simulation will start from specifying the
  material parameters in the notebook (all of this is given in the
  tutorial), to running the simulation in the notebook to processing
  of computed data while the simulation runs (or subsequently) in the
  notebook; thus providing one virtual research environment, with all
  the associated benefits of making best use of the scientist's time
  using the tool and environment.

  The documentation and tutorial will include a number of typical
  micromagnetic case studies that (i) demonstrate the correctness of
  the code by executing some of the micromagnetic standard problems
  and (ii) demonstrate the additional power gained by the
  IPython-based OOMMF interface. We expect this substantial, executable
  documentation to become the standard resources that introduces
  researchers to computational micromagnetics.
\end{task}

\begin{task}[id=oommf-nb-ve,title=OOMMF case study: \OOMMFNB{} virtual environments]
  % 3 person months
  Recently, a TeMPorary Jupyter NoteBook has been made available at
  \href{http://tmpnb.org}{http://tmpnb.org}, that allows anybody to go
  to this URL and use their very own Jupyter notebook for quick
  calculations and tests online. We will provide similar functionality
  but for a server that provides the \OOMMFNB{} software and \OOMMFNB{}
  documentation and tutorials so that the tutorial can be executed
  immediately on that web server; thus removing the barrier of having
  to install (the OOMMF and Jupyter notebook) code before being able to interactively drive and test a
  simulation system.

  We will further provide as open source the scripts that allow
  creation of virtual environments (such as vagrant scripts to
  generate VirtualBox \cite{Virtualbox} images, and Docker
  \cite{Docker} containers). These virtual environments underpin the
  web hosted temporary \OOMMFNB{} service (we anticipate to use Docker
  on the web hosted service) but are also of use to those users who
  want to download a complete virtual machine (such as a virtualbox
  image) to run their simulations within that machine. The same
  virtual machine images can also be used for Cloudhosted computing services.

  % XXX HF Financial details should probably go elsewhere.
  We request 3100 EUR (ex VAT) to purchase a machine to provide these
  services (shared memory, 16 cores, 64GB RAM, small solid state drive
  to make the system more responsive). This machine will also support
  the regression testing and continuous integration (see task
  \taskref{dissem}{dissemination-of-oommf-nb-virtual-environment}). Setup and
  maintenance of the machine is part of this work task.
\end{task}

\end{tasklist}

\begin{wpdelivs}
  \begin{wpdeliv}[due=12,id=ipython-kernels-basic,dissem=PU,nature=O]
      {Basic Jupyter interface for GAP, Pari, Sage, Singular}
  \end{wpdeliv}
  
  \begin{wpdeliv}[due=12,id=ipython-kernels,dissem=PU,nature=O]
      {Full featured Jupyter interface for GAP, Pari, Singular}
  \end{wpdeliv}
  
  \begin{wpdeliv}[due=12,id=ipython-kernel-sage,dissem=PU,nature=DEM]
      {Sage notebook / Jupyter notebook convergence}
  \end{wpdeliv}

  \begin{wpdeliv}[due=18,id=jupyter-test,dissem=PU,nature=O]
      {Using notebooks for verification tests}
  \end{wpdeliv}
  
  \begin{wpdeliv}[due=12,id=jupyter-collab,dissem=PU,nature=O]
      {Improvements to notebook collaboration}
  \end{wpdeliv}

  \begin{wpdeliv}[due=36,id=jupyter-live-collab,dissem=PU,nature=O]
      {Explore live notebook collaboration}
  \end{wpdeliv}
  
  
  \begin{wpdeliv}[due=36,id=ipython-advanced-interacts,dissem=PU,nature=DEM]
      {Exploratory support for semantic-aware interactive widgets providing views on objects
      represented and or in databases}
  \end{wpdeliv}

  % Shared Jupyter sessions embedded in voice-over-IP or
  % teleconference calls or reciprocally.
  %
  % NOTE: This task is probably outdated by appear.in which makes
  % video-conferencing in the browser trivial
  %
  % \delivref{ipython-collaborative}
  % Eugen Dedu:
  % I think such a module can be thought of as a screen-capturing
  % module, i.e. allow Ekiga to capture the screen of a Sage user (this
  % is currently not possible).  This is not a difficult task to do.
  % Julien Puydt: ekiga can do that since something like 2008 with my
  % experimental gstreamer plugin, and I shall be able to present
  % interesting sample code to the ekiga-devel mailing-list in something
  % like two-three weeks (after I'm done with my students), which will
  % hopefully be part of the next version.
  % 
  % But as Nicolas noted in his answer, some kind of interative session
  % where people can share a sage session would be better.
  % 
  % I think the feature decomposes in the following pieces:
  % - IPython should have a way to share sessions between several
  % participants using an open and standard protocol ;
  % - ekiga should implement it.
  % 
  % In my opinion ekiga, because of its dependency on ptlib and opal
  % libraries and the use of complex protocols like SIP and H323, needs
  % highly technical people.  Students cannot help much, but engineers
  % are appropriate.
  \begin{wpdeliv}[due=9,id=oommf-py-raw,dissem=PU,nature=O]
      {Python Interface to OOMMF}
\end{wpdeliv}
  \begin{wpdeliv}[due=15,id=oommf-nb,dissem=PU,nature=DEM]
      {Jupyter notebook Interface for OOMMF (\OOMMFNB{})}
\end{wpdeliv}
  \begin{wpdeliv}[due=21,id=oommf-nb-documentation,dissem=PU,nature=DEC]
      {\OOMMFNB{}    executable tutorial and documentation}
\end{wpdeliv}
  \begin{wpdeliv}[due=24,id=oommf-nb-tmp,dissem=PU,nature=DEC]
      {\OOMMFNB{} dynamic web service available}
\end{wpdeliv}
  \begin{wpdeliv}[due=24,id=oommf-nb-virtual,dissem=PU,nature=O]
      {\OOMMFNB{} virtual machine images available for download}
  \end{wpdeliv}
\end{wpdelivs}
\end{workpackage}

\begin{verbatim}

About the availability of people to hire, I have a full-time,
experienced developer whose contract runs out in fall 2015, he would be
ideal for the project. I also have a doctoral student who needs
employment after the MathSearch project (until 10/2015) runs out. So I
do have people who would directly be available.

Michael

===================8<---------------------------------

Task 4.10. Structured Documents (12 PM total, 3 PM per deliverable)
   -> This existing task we could just take over based on our MathHub.info
         system, which would need to be adapted to the task.
Deliverables:
   D1: Active Documents based on sTeX
   D2: Distributed, Collaborative, Versioned Editing of Active Documents
in MathHub.info
   D3: Notebook Import into MathHub.info (interactive display)
   D4: in-place computation in active documents (context/computation).
Comments:
  MathHub.info is a portal for reading and interacting with "active
documents"
  (i.e. documents that have an additional semantic layer that supports
semantic services like
   - definition lookup, type-inference, unit conversion, ...)
  Notebooks are essentially "programs with documentation", whereas
active documents are
  documents with a semantic knowledge layer. Regular publications are an
important
  boundary case: Active Documents look like papers, but are
web-standards compatible
  and interactive.
  sTeX is a semantic variant of LaTeX that we can transform into OMDoc/MMT,
  which is the native knowledge representation format for active documents
  and machine-actionable knowledge about math and symbolic programs.

===================8<---------------------------------

Task K-4.11 Math Search Engine (10 PM total; 2 each for D1/2, 3 each for
D3/4)
   D1: Full-text search (formulae + Keywords) over LaTeX-based documents
         (e.g. arXiv subset)
   D2: Full-text search (F+K) over Notebooks (in the format determined
in task 4.7)
   D3: Formula search in CAS programs and Software Modules
   D4: Search from Notebooks/Active Documents (for local context to
inform search)
Comments:
   We already have a search engine, therefore we only need to build
harvesters for D1/2;
   D3/4 are more speculative.

\end{verbatim}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../proposal.tex"
%%% End: 
