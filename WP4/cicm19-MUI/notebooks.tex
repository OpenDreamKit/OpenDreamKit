We now discuss the integration of Jupyter Notebooks into the MathHub system.

\subsection{Overview}

The Jupyter-extended MathHub system consists of four components:
\begin{compactenum}
\item A GitLab repository hosting server \url{https://gl.mathhub.info} that provides persistent storage of documents in any format, including their OMDoc representation.
\item A Jupyter Notebook server \url{https://jupyter.mathhub.info} provides web-based IDE for editing interactive documents
\item An MMT instance which uses the OMDoc representations to provides the shared knowledge space and provides a high-level API for it\footnote{
    Technically, each kernel has a separate MMT instance in addition to the primary one. 
    Except for the ephemeral document representing each Notebook, these are identical to the main instance. 
    These exist only to isolate different users from one another, and prevent scenarios where they could unintentionally break each others notebook sessions.  
  }.
\item The MathHub frontend \url{https://mathhub.info} that serves as the main entry point and delegates some subtasks to the former.
  We have extended MathHub front-end with a new document type presenter for notebooks that gives access to the source, context, statistics, and metadata of notebooks, and provides a ``preview'' and ``interact inline'' views.  
\end{compactenum}

The Jupyter server is an out of the box installation of Jupyter except for additionally supporting our new MMT kernel and a small plugin enabling smoother opening of notebooks via a URL. 
Consequently, the integration between the Jupyter and the MathHub frontends is shallow: MathHub opens Jupyter Notebooks in separate tabs or iframes using URLs served by Jupyter.

\subsection{Notebooks as Parts of Semantic Documents}

To interact dynamically with content in arbitrary MathHub documents, we can make use of the active computation widget presented in Section~\ref{sec:kernel:widgets}. 
For this purpose we implemented a new feature that creates a new ephemeral Jupyter Notebook and allows accessing it from the current document. 
Importantly, the new Notebook is pre-filled with an import of the current context. 

\begin{figure}[h]
  \begin{minipage}[c]{5.5cm}
  \vspace{-20pt}
  \includegraphics[width=5.5cm]{screenshots/sciencedoc}
  \end{minipage}
  \begin{minipage}[c]{7cm}
    \input{figures/sourcecode}
  \end{minipage}
  \caption{A semantic HTML document and an abbreviated version of the source code}\label{fig:conversionHTML}
\end{figure}

Figure~\ref{fig:conversionHTML} shows a (simplified) scientific HTML document (on the left) and an extract of its source code (on the right).
The document contains the equation $E=mc^2$. 
The user can use the context menu to trigger the notebook generation on this formula.

This scientific document is semantically annotated. 
Most notably, the formula that the user can interact with defines the variables that the user might want to interactively change using the \texttt{data-declares} attribute. 
Futhermore, the document contains a reference to an MMT context (using the \texttt{data-theory} attribute). 
This gives semantic meaning to the formula. 

\begin{wrapfigure}{l}{8cm}\vspace*{-2em}
  \includegraphics[width=8cm]{screenshots/emc}\vspace*{-1em}
\caption{The resulting Jupyter notebook/widget}\label{fig:conversionNotebook}\vspace*{-2em}
\end{wrapfigure}
The context menu is generated using JavaScript that picks up on these annotations.
Currently the author has to manually create the formula and context annotations, but we are working on a mechanism to automatically create it from the document context.
The data is then sent to our Jupyter installation using appropriate URL parameters. 

Figure~\ref{fig:conversionNotebook} shows the notebook created by our tool.
This notebook starts with an \texttt{include} declaration of the document context. 
These are generated by our tool to obtain a minimal standalone MMT theory in which the respective formula is well-formed. 
The notebook then directly instantiates the active computation widget we presented above using the parameters extracted from the document. 

In this demonstration we directly show the Jupyter Notebook to the user in a separate window. 
If desired, the notebooks can be easily uploaded to the Jupyter server, stored persistently in the repository server, or evaluated in a locally deployed version of the system per drag-and-drop.

%%% Local Variables:
%%% mode: latex
%%% mode: visual-line
%%% fill-column: 5000
%%% TeX-master: "paper"
%%% End:

%  LocalWords:  Jupyter ednote compactenum textsf texttt visualizations RupKohMue:fitgv17 nbdime centering fbox includegraphics NB-Mathhub compactitem oldpart vspace sciencedoc wrapfigure emc Futhermore
