\section{Integrating mathematical software systems via the Math-in-the-Middle approach}\label{sec:mitm}

% Mathematics has a rich notion of data: it can be either numeric or symbolic data;
% knowledge about mathematical objects given as statements (definitions, theorems or
% proofs); or software that computes with these mathematical objects. All this data is
% really a common resource, and should be maintained as such

\ednote{NT: I don't know how much highlight we want to put on VREs or
  ODK here. Of course, we are doing our experimentations with the ODK
  components. But it's about large scale integration of math software
  components in general, not necessarily just in the context of VREs.}

To achieve the goal of assembling the ecosystem of mathematical software systems in the
\ODK project into a coherent mathematical virtual research environment, we have to make
the systems interoperable at a mathematical level.

In particular, we have to establish a common meaning space that
allows sharing mathematical \emph{concepts} amongst the respective systems.

Building on this, we can construct a virtual research environment using established techniques
used in integrated development environments.

\ednote{R1: What is the effort involved in creating the interface theories?
 Can this be somehow characterized in general, or perhaps (e.g., using time as a 
measure of effort) by illustration based on the example included in the paper? 
Does the approach require that every piece of the source system be translated 
individually and statically inserted into the wrapper? If a new component is 
added to the source (an update), does a corresponding new component need to 
be added manually to the interface, or does the interface somehow provide a 
mechanism for automatic updates to incorporate new translations from an 
existing source? (In other words, is the wrapper in fact a complete re-implementation 
of the source functionality in the MitM language, or is a run-time translator 
that runs between the source and the mediator?)}
\ednote{R3: "a common meaning space that allows to share computation" - just one example 
of nonstandard grammar in this paper}
\ednote{R3: "Building on this we can build a VRE with classical techniques for integrated 
development environments" - Perhaps you could add a reference to a comparison case or two 
that would back up this claim.}

\subsection{A common meaning space for interoperability}

Specifically, the problem is that the software systems in \ODK cover different aspects of
mathematics, and if there are overlaps, then representations and functionalities provided 
differ.
This starts with simple naming issues, for example elliptic curves are called
\lstinline|ec| in the \LMFDB, and \lstinline|EllipticCurve| in \Sage, and persists through
the underlying data structures, and becomes obstructive at the level of algorithms, their
parameters, and domains of applicability.

To obtain a common meaning space for a VRE, we have the three well-known approaches in
Figure~\ref{fig:interop}.
\begin{figure}[ht]\centering
  \begin{tabular}{|c|c|c|}\hline
    peer to peer & open standard & industry standard\\\hline
    \input{../tikz/fullgraph} & \input{../tikz/mstargraph} & \input{../tikz/stargraph}\\\hline
    $n^2/2$  translations & $2n$ translations & $2n-2$ translations \\
    symmetric & symmetric & asymmetric\\\hline
  \end{tabular}
  \caption{Approaches for many-systems interoperability}\label{fig:interop}
\end{figure}

The first does not scale to a project with about a dozen systems, for the third there is
no obvious contender in the \ODK ecosystem. Fortunately, we already have a standard for
expressing the meaning of mathematics -- \defemph{mathematical vernacular}: the language of
mathematical communication. All mathematical concepts in the scope of the \ODK VRE are documented
in mathematical vernacular in journal articles, manuals, etc.
\ednote{R3: "mathematical vernacular" - This is sometimes used in a specific formal way, you 
might need to distinguish your usage from that.  (I.e. *which* mathematical vernacular are you 
referring to.)}

The obvious problem is that mathematical vernacular is too 
\begin{inparaenum}[\em i\rm)]
\item \emph{ambiguous}: we need a human to understand structure, words, and symbols
\item \emph{redundant}: every paper introduces slightly different notions. 
\end{inparaenum}

Therefore, we explore an approach, where we \defemph{flexiformalize} (i.e. partially formalize;
see~\cite{Kohlhase:tffm13}) mathematical vernacular to obtain a flexiformal ontology of
mathematics that can serve as an open communication vocabulary. We call the approach the
\defemph{Math-in-the-Middle} (MitM) Strategy for integration and the ontology the \defemph{MitM
ontology}.

\begin{wrapfigure}r{4cm}\vspace*{-1.5em}
  \input{../tikz/mistargraph}\vspace*{-.5em}
  \caption{Interface theories}\label{fig:interface-theories}\vspace*{-1em}
\end{wrapfigure}
Before we go into any detail about what this ontology looks like, and how it induces a uniform
meaning space, we have to address another problem: the descriptions in the MitM ontology
must at the same time be system-near to make interfacing easy for systems, and serve as
an interoperability standard -- \emph{i.e.}\ be general and stable. If we have an ontology system
that allows modular/structured ontologies, we can solve this apparent dilemma by
introducing \defemph{interface theories}~\cite{KohRabSac:fvip11}. These are ontology modules
, depicted as light purple circles in Figure~\ref{fig:interface-theories}, that are at the same
time system-specific in their description of mathematical concepts, and part of the greater MitM
ontology.

This is depicted by the cloud in Figure~\ref{fig:interface-theories} as they are connected to the
core MitM ontology by views we call \defemph{inter-views}.

The MitM approach stipulates that interface theories and inter-views are maintained and released
together with the respective systems, whereas the core MitM ontology represents the mathematical
scope of the VRE and is maintained with it. In fact in many ways, the core MitM ontology is the
conceptual essence of the mathematical VRE.

\ednote{R1: The choice of the term "interviews" is unfortunate because the common meaning 
of that word is not based on "inter-views". If a better term cannot be found, perhaps 
the inclusion of a hyphen would help a reader by reducing the inclination to misunderstand the term.}
\ednote{R3: "Before we go into any detail about how this ontology looks" - I think before going 
further you should add a few more details about what the process of flexiformalization is, 
or at least pointing out that there will be an example presented in Section 4}
\ednote{R3: "must at the same time be system-near" - at the same time as...?}
\ednote{R3: "in many ways, the core MitM ontology is the conceptual essence of the 
mathematical VRE." - interesting.}

\subsection{Realizing and utilizing a MitM ontology}

\begin{wrapfigure}r{6.2cm}\centering\vspace*{-2em}
  \input{../tikz/metalogics}\vspace*{-.5em}
  \caption{A OMDoc/MMT Theory Graph}\label{fig:mmt}\vspace*{-1em}
  \label{figure.omdoc.example}
\end{wrapfigure}
\ednote{R3: "views (the squiggly arrows)" - - what's going on with the 
upwards-pointing arrow in Figure 3, mod? (i.e. why is this one not dotted?)}
Our current candidate for representing the MitM ontology is the OMDoc/MMT
format~\cite{Kohlhase:OMDoc1.2,MMTSVN:on}. OMDoc/MMT is an ontology format to
represent mathematical knowledge modularly in a theory graph: \defemph{theories} are
collections of declarations of concepts, objects, and their properties that are connected
by truth-preserving mappings called \defemph{theory morphisms}. The latter come in two
forms: \defemph{inclusions} and \defemph{structures} that essentially correspond to
object-oriented inheritance, and \defemph{views} that connect pre-existing theories -- in
these all axioms of the source theory have be to proven in the target theory. See
~\cite{RabKoh:WSMSML13} for a full account. Figure~\ref{fig:mmt} shows an example of a
theory graph. It has three layers:
\ednote{R3: "latter come in two forms" - maybe say a bit more about the difference 
between inclusion and structure in this terminology?}
\begin{compactenum}[\em i\rm)]
\item the (bottom) \defemph{domain level}, which specifies mathematical domains as theories; here
  parts of elementary algebra. The hooked arrows are inclusions for inheritance, while the
  regular arrows are named structures that induce the additive and multiplicative
  structures of a ring.
\item the \defemph{logic level} represents the languages we use for talking about the
  properties of the objects at the domain level -- again as theories: the meta-theories of
  the domain-level ones -- the dotted arrows signify the meta-relation. At this level, we
  also have inclusions and views (the squiggly arrows) which correspond to logic
  translations (\cn{f2h}) and interpretations into \defemph{foundational theories} like
  set theory (here \cn{ZFC}). Incidentally models can be represented as views into
  foundations.
\item The top layer contains theories that act as metalogics, \emph{e.g.}\ the Logical Framework
  \cn{LF} and extensions which can be used to specify logics and their translations.
\end{compactenum}
The theory graph structure is very well-suited to represent heterogeneous collections of
mathematical knowledge, because views at the domain level can be used to connect differing
but equivalent conceptualizations and views at the logic level can be used to bridge the
different foundations of the various systems. The top level is only indirectly used in
the MitM framework: it induces the joint meaning space via the meta-relation.

\begin{figure}[ht]\centering
  \input{../tikz/kf-paradigm}
  \caption{The MitM Paradigm in Detail}\label{fig:mitm}
\end{figure}
\ednote{R3: The text should say what LEC SEC and GEC, as well as PyF, C++F, and so on are.}
If we apply OMDoc/MMT to the MitM architecture, we arrive at the situation in
Figure~\ref{fig:mitm}, where we drill into the MitM information architecture from
Figure~\ref{fig:interface-theories}, but restrict at this stage to three systems from the \ODK
project. In the middle we see the core MitM ontology (the blue cloud) as an OMDoc/MMT
theory graph connected to the interface theories (the purple clouds) via MitM
interviews. Conceptually, the systems in \ODK consist of three main components:
\ednote{R3: "MitM interviews" - are these the same as the "views" described before?}
\begin{compactenum}[\em i\rm)]
\item a \emph{Knowledge Representation component} that provides data structures for the
  COMs and their properties.
\item a \emph{DataBase component} that provides mass storage for objects, and 
\item a \emph{library of algorithms} that operate on these.
\end{compactenum}
To connect a system to an MitM-based VRE, the knowledge representation component is either
refactored so that it can generate interface theories, or a schema-like description of the
underlying data structures is created manually from which abstract data structures for the
system can be generated automatically -- in this version the interface theories act as an
Interface Description Language.

In this situation there are two ways to arrive at a greater MitM ontology: the \ODK
project aims to explore both: either
\begin{inparaenum}[\em i\rm)] 
\item standardizing a core MitM by refactoring the various interface theories where they
  overlap, or
\item flexiformalizing the available literature for a core MitM ontology.
\end{inparaenum}
For \emph{i}), the MitM interviews emerge as refinements that add system-specific details
to the general mathematical concepts\footnote{We use the word ``interface theory'' with a
  slightly different intention when compared to the original use
  in~\cite{KohRabSac:fvip11}: There the core MitM ontology would be an interface between
  the more specific implementations in the systems, whereas here we use the ``interface
  theories'' as interfaces between systems and the core MitM ontology. Technically the
  same issues apply.} For \emph{ii}), we have to give the interviews directly. 

To see that this architecture indeed gives us a uniform meaning space, we observe that the
core MitM ontology uses a mathematical foundation (presumably some form of set theory),
whereas the interface theories also use system-specific foundations that describe aspects
of the computational primitives of the respective systems. We have good formalizations of
the mathematical foundations already; first steps towards a computational ones have been
taken in~\cite{KohManRab:aumftg13}.

Our efforts also fit neatly alongside similar efforts underway across the sciences to
standardize metadata formats (for instance through the Research Data Alliance's Typing
Registry Working Group\cite{rda-typing}), except that the typing taking place here tends
to have much higher complexity since our objects of study are sometimes seen as types and
sometimes as instances (think of groups for instance). 

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "paper"
%%% End:

%  LocalWords:  pn visualization lstinline ec lstinline Weierstrass ednote interop hline
%  LocalWords:  centering tikz fullgraph tikz mstargraph tikz stargraph defemph emph mmt
%  LocalWords:  inparaenum flexiformalize flexiformal wrapfigure vspace mistargraph cn
%  LocalWords:  KohRabSac fvip11 Realizing Utilizing metalogics specialized RabKoh mitm
%  LocalWords:  compactenum conceptualizations kf-paradigm standardizing flexiformalizing
%  LocalWords:  formalizations KohManRab aumftg13 tffm13 standardize rda-typing
